<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>A simple map</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script>
        var neighborhoods = $.ajax({
            url: "https://gist.githubusercontent.com/nossu3751/1342f22cd7c58a1bb07807ce1142dc91/raw/07c0015e503f60d4f2a50a34a5333b0e228c0989/mass_zipcode.geojson",
            dataType: "json",
            success: console.log("County data successfully loaded."),
            error: function(xhr) {
                alert(xhr.statusText)
            }
        })
        $.when(neighborhoods).done(function() {
            var map = L.map('map')
                .setView([42.33, -71.06], 12 );

            var basemap = L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png',
              {
                attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
                maxZoom: 17,
                minZoom: 11
              }).addTo(map);
            
              var neighborhoodBorder = L.geoJSON(neighborhoods.responseJSON).addTo(map);
              var marker = L.marker([42.33, -71.06]).addTo(map);
              var marker1 = L.marker([42.34, -71.07]).addTo(map);
              var marker2 = L.marker([42.35, -71.08]).addTo(map);
              var marker3 = L.marker([42.36, -71.09]).addTo(map);
              var markers = new Array(marker1, marker2, marker3);

              <% @sensors.each do |sensor| %>
                <% location = sensor.location.split(","); %>
                <% location.each do |c| %>
                    <% c = c.to_f %>
                <% end %>
                marker_tmp = L.marker(<% location %>).addTo(map);
                markers.push(marker_tmp);
             <% end %>
            });
    </script>
    
</body>

</html>
